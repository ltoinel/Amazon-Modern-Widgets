<!doctype html>
<html lang="fr">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">

  <!-- jQuery and JS bundle w/ Popper.js -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>

  <title>AMW Card</title>

  <style>
    a {
      color: #FFF;
    }

    a:hover {
      color: #CCC;
    }

    body {
      background: none transparent;
    }

    .card-img {
      display: none;
    }

    .amazon-prime {
      display: none;
      margin-left: 5x;
    }

    .card-body {
      display: none;
      padding: 5px;
    }

    h1 {
      font-size: 1em;
    }

    .text-muted {
      font-size: 0.7em;
    }

    .card {
      border-width: 3px;
    }

    .price {
      font-weight: bold;
    }
  </style>
</head>

<body>

  <!-- Product Card -->
  <div class="card text-white bg-dark shadow-lg rounded-lg">

    <div class="row">

      <!-- Card Image -->
      <div class="col-sm-3 col-md-3 col-lg-3">
          <a href="#" class="link" target="_blank"><img src="" alt="Amazon product" class="card-img img-responsive" /></a>
      </div>

      <!-- Card Body -->
      <div class="col-sm-9 col-md-9 col-lg-9">

        <div class="card-body">

          <!-- Production caption-->
          <h1 class="card-title"><a href="#" class="caption" target="_blank" rel="nofollow"></a></h1>

          <!-- Product Price-->
          <a href="#" class="btn btn-secondary btn-sm price link" role="button" target="_blank" rel="nofollow"></a>

          <!-- Button link to Amazon product page -->
          <a href="#" class="btn btn-success btn-sm link" role="button" target="_blank" rel="nofollow">

            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white" width="18px" height="18px">
              <path d="M0 0h24v24H0V0z" fill="none" />
              <path
                d="M15.55 13c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.37-.66-.11-1.48-.87-1.48H5.21l-.94-2H1v2h2l3.6 7.59-1.35 2.44C4.52 15.37 5.48 17 7 17h12v-2H7l1.1-2h7.45zM6.16 6h12.15l-2.76 5H8.53L6.16 6zM7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zm10 0c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z" />
            </svg>

            <span class="buy"></span>

          </a>

          <!-- Amazon prime eligibility -->
          <img
            src="data:image/png;base64,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"
            alt="Amazon Prime" class="amazon-prime" />

          <!-- Last update-->
          <p class="card-text"><small class="text-muted"><span class="timestamp"></span></small>
          </p>

        </div>
      </div>
    </div>

    <!-- Loading Spinner -->
   <div class="text-center m-5 spinner">
      <div class="spinner-grow text-success" role="status">
        <span class="sr-only">Loading...</span>
      </div>
      <div class="spinner-grow text-danger" role="status">
        <span class="sr-only">Loading...</span>
      </div>
      <div class="spinner-grow text-info" role="status">
        <span class="sr-only">Loading...</span>
      </div>
  </div>

  </div>


  <script>

    // Feed the Card HTML template from Amazon information
    $(function () {

      lang = {
          fr : {
              buy : 'Acheter sur Amazon',
              update : 'â†» DerniÃ¨re mise Ã  jour : ',
              not_available : "Non disponible"
          },
          es : {
              readmore : 'Comprar en Amazon',
              date     : 'â†» Ultima actualizaciÃ³n : ',
              not_available : "No disponible"
          },
          en : {
              readmore : 'Buy on Amazon',
              date     : 'â†» Last product update : ',
              not_available : "Not available"            
          }
      }

      // Find the langage code
      var languageCode = $('html').attr('lang');

      // Get the product param
      let urlParams = new URLSearchParams(window.location.search);
      let url;

      // If we know the product to display
      if (urlParams.get('id')){
        let id = urlParams.get('id');
         url = "product?id=" + id;
      }
    
      // We have a product to search
      else if (urlParams.get('keyword')){
        let keyword = urlParams.get('keyword');
         url = "product?keyword=" + keyword;
      }

      // Call the card API
      $.getJSON(url, function (product) {

        // We add the information
        $(".card-img").attr("src", product.image);
        $(".caption").html("ðŸ”¥ " + product.title);
        $(".caption").attr("href", product.url);
        $(".link").attr("href", product.url);
        $(".timestamp").html(lang[languageCode].update + new Date(product.timestamp).toLocaleString());
        $(".buy").html(lang[languageCode].buy);

        // If the product is available or not in stock
        if (product.price == -1){
          $(".price").html(lang[languageCode].not_available);
        } else {
          $(".price").html(product.price);
        }
        
        // If the product is elligible to prime
        if (product.prime) {
          $(".amazon-prime").css('display', 'inline');
        }

        // We hide the spinners
        $(".spinner").css('display', 'none');

        // We show the block
        $(".card-img").css('display', 'block');
        $(".card-body").css('display', 'block');

        // We send a message to the parent
        window.parent.postMessage("ready", "*");

      }).fail(function() {

        $(".card").css('display', 'none');
        console.log( "Amazon product not found" );
     });

    });
  </script>

</body>

</html>