<!doctype html>
<html lang="fr">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Bootstrap  -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
  
  <!-- JQuery -->
  <script src="https://code.jquery.com/jquery-3.6.4.min.js" integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>


  <title>AMW Card</title>

  <style>
    
    body {
      background: none transparent;
    }

    a {
      color: #FFF;
      text-decoration:none; 
    }

    a:hover {
      color: #CCC;
    }

    .card {
      max-width: 1000px;
      background-color: #333;
      border: 1px solid orange;
    }

    .card-title {
      font-size: 1em;
      margin-bottom: 20px;
    }

    .card-img-container {
      overflow: hidden; 
    }

    /* Quick-zoom Container */
    .card-img {
      transform-origin: 50% 65%;
      transition: transform 5s, filter 3s ease-in-out;
      display: none;
    }

    /* The Transformation */
    .card-img:hover {
      transform: scale(1.2);
    }

    .card-body {
      display: none;
      padding: 8px;
    }

    .amazon-prime {
      display: none;
    }

    .text-muted {
      font-size: 0.6em;
    }

    .btn {
      margin-right: 20px;
    }

    .amazon{
      color: #555;
    }

    .amazon svg{
      margin-right: 5px;
    }

    .price{
      font-weight: bold;
    }

    .blink {
      animation: blinker 2s linear infinite;
    }

    @keyframes blinker {
      50% {
        opacity: 0;
      }
    }

  </style>
</head>

<body>

  <!-- Product Card -->
  <div class="card">

    <div class="row">

      <!-- Card Image -->
      <div class="col-4 col-sm-3 card-img-container">
          <a href="#" class="link" target="_blank"><img src="" alt="Amazon product" class="card-img img-fluid rounded-start"/></a>
      </div>

      <!-- Card Body -->
      <div class="col-8 col-sm-8">

        <div class="card-body">

          <!-- AMW advise-->
          <a href="https://www.geeek.org/amazon-affiliation-modern-widgets/" class="position-absolute top-0 end-0 badge bg-light text-dark text-muted d-none d-md-inline">AMW</a>

          <!-- Production caption-->
          <h1 class="card-title text-truncate"><a href="#" class="caption" target="_blank" rel="nofollow"></a></h1>
         
          <!-- Product Price-->
          <a href="#" class="btn btn-success price link position-relative" role="button" target="_blank" rel="nofollow"></a>

          <!-- Button link to Amazon product page -->
          <a href="#" class="btn btn-warning amazon link d-none d-sm-inline" role="button" target="_blank" rel="nofollow">
            <svg height="22px" width="22px"  viewBox="0 0 128 128" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--noto" preserveAspectRatio="xMidYMid meet" fill="#000000"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path d="M116 4H12c-4.4 0-8 3.6-8 8v104c0 4.4 3.6 8 8 8h104c4.4 0 8-3.6 8-8V12c0-4.4-3.6-8-8-8z" fill="#557755"></path><path d="M109.7 4H11.5C7.4 4 4 7.4 4 11.5v97.9c0 4.2 3.4 7.5 7.5 7.5h98.1c4.2 0 7.5-3.4 7.5-7.5V11.5c.2-4.1-3.3-7.5-7.4-7.5z" fill="#5ea169"></path><path d="M39.7 12.9c0-2.3-1.6-3-10.8-2.7c-7.7.3-11.5 1.2-13.8 4s-2.9 8.5-3 15.3c0 4.8 0 9.3 2.5 9.3c3.4 0 3.4-7.9 6.2-12.3c5.4-8.7 18.9-10.6 18.9-13.6z" opacity=".5" fill="#477147"></path><path d="M38.8 105.5a8.862 8.862 0 0 1-8.7-6.2L15 53.8c-1.46-4.81 1.26-9.9 6.07-11.36c4.65-1.41 9.59 1.08 11.23 5.66l9.8 29.5L89.2 18c3.12-3.95 8.85-4.62 12.8-1.5s4.62 8.85 1.5 12.8L45.9 102a9.086 9.086 0 0 1-7.1 3.5z" fill="#fbf9f9"></path></g></svg>           
            <span class="buy"></span>
          </a>

          <!-- Amazon prime eligibility -->
          <img
            src="data:image/png;base64,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"
            alt="Amazon Prime" class="amazon-prime" />

          <!-- Last update timestamp -->
          <p class="card-text d-none d-sm-block"><small class="text-muted"><span class="timestamp"></span></small></p>

        </div>
      </div>
    </div>

    <!-- Loading Spinner -->
   <div class="text-center m-5 spinner">
      <div class="spinner-grow text-warning" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <div class="spinner-grow text-warning" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <div class="spinner-grow text-warning" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
  </div>

  </div>


  <script>

    // Feed the Card HTML template from Amazon information
    $(function () {

      lang = {
          fr : {
              buy : 'Intéressant !',
              update : '↻ Dernière mise à jour : ',
              not_available : "Non disponible"
          },
          es : {
              readmore : 'Mas detalles',
              date     : '↻ Ultima actualización : ',
              not_available : "No disponible"
          },
          en : {
              readmore : 'More details',
              date     : '↻ Last product update : ',
              not_available : "Not available"            
          }
      }

      // Find the langage code
      var languageCode = $('html').attr('lang');

      // Get the product param
      let urlParams = new URLSearchParams(window.location.search);
      let url;

      // If we know the product to display
      if (urlParams.get('id')){
        let id = urlParams.get('id');
         url = "product?id=" + id;
      }
    
      // We have a product to search
      else if (urlParams.get('keyword')){
        let keyword = urlParams.get('keyword');
        url = "product?keyword=" + keyword;
      }

      // Call the card API
      $.getJSON(url, function (product) {

        if (product === null){
          $(".card").css('display', 'none');
          console.log( "Amazon product not found" );

        } else {

          // We add the information
          $(".card-img").attr("src", product.image);
          $(".caption").html(product.title);
          $(".caption").attr("href", product.url);
          $(".link").attr("href", product.url);
          $(".timestamp").html(lang[languageCode].update + new Date(product.timestamp).toLocaleString());
          $(".buy").html(lang[languageCode].buy);

          // If the product is available or not in stock
          if (product.price == -1){
            $(".price").html(lang[languageCode].not_available);
          } else {
            $(".price").html(product.price);
          }

          // If the product is elligible to prime
          if (product.prime) {
            $(".amazon-prime").css('display', 'inline');
          }

          // If the product has savings
          if (product.savings != 0) {
            $(".price").html(product.price + "<span class=\"position-absolute top-0 start-100 translate-middle badge savings blink rounded-pill bg-danger\">-"+product.savings+"%<span class=\"visually-hidden\">Savings</span></span>")
          }

          // We hide the spinners
          $(".spinner").css('display', 'none');

          // We show the block
          $(".card-img").css('display', 'block');
          $(".card-body").css('display', 'block');

        }
        
        // We send a message to the parent
        window.parent.postMessage("ready", "*");

      }).fail(function() {

        $(".card").css('display', 'none');
        console.log( "Amazon product not found" );
     });

    });
  </script>

</body>

</html>
